<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="/styles/index.css">
    <link rel="stylesheet" href="/styles/create.css">
    <link rel="stylesheet" href="/styles/responsive.css">
</head>
<body>
    <div class="container">
        <header class="dashboard-header">
            <h1>Admin Dashboard</h1>
            <div class="header-info">
                <span class="date-time" id="current-time"></span>
            </div>
        </header>

        <!-- Notification area -->
        <div class="notification" id="notification"></div>

        <!-- Tab navigation -->
        <nav class="tabs">
            <button class="tab-button active" data-tab="users">
                <span class="tab-icon">ðŸ‘¥</span>
                Users
            </button>
            <button class="tab-button" data-tab="appointments">
                <span class="tab-icon">ðŸ“…</span>
                Appointments
            </button>
            <button class="tab-button" data-tab="invoices">
                <span class="tab-icon">ðŸ’°</span>
                Invoices
            </button>
        </nav>

        <!-- Users Tab -->
        <section id="users" class="tab-content active">
            <div class="section-header">
                <h2>Users Management</h2>
                <button class="btn btn-primary" data-action="create" data-type="user">
                    <span class="btn-icon">âž•</span>
                    Add User
                </button>
            </div>

            <!-- Filters for Users -->
            <div class="filters-container">
                <div class="search-group">
                    <input type="text" id="users-search" placeholder="Search users..." class="search-input">
                </div>
                <div class="sort-group">
                    <select id="users-sort" class="sort-select">
                        <option value="fullName-asc">Name (A-Z)</option>
                        <option value="fullName-desc">Name (Z-A)</option>
                        <option value="email-asc">Email (A-Z)</option>
                        <option value="email-desc">Email (Z-A)</option>
                        <option value="createdAt-desc">Newest First</option>
                        <option value="createdAt-asc">Oldest First</option>
                    </select>
                </div>
                <div class="filter-actions">
                    <button class="btn btn-light btn-sm" id="users-clear-filters">Clear Filters</button>
                    <span class="results-count" id="users-count"><%= users.length %> users</span>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Full Name</th>
                            <th>Email</th>
                            <th class="hide-mobile">Phone Number</th>
                            <th>isAdmin</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% users.forEach(user => { %>
                            <tr id="user-row-<%= user._id %>" data-id="<%= user._id %>" 
                                data-name="<%= user.fullName.toLowerCase() %>" 
                                data-email="<%= user.email.toLowerCase() %>"
                                data-phone="<%= (user.phoneNumber || '').toLowerCase() %>"
                                data-isAdmin="<%= user.isAdmin %>"
                                data-created="<%= user.createdAt %>">
                                <td data-label="Name">
                                    <span class="view-mode"><%= user.fullName %></span>
                                    <input type="text" class="edit-mode" name="fullName" value="<%= user.fullName %>">
                                </td>
                                <td data-label="Email">
                                    <span class="view-mode"><%= user.email %></span>
                                    <input type="email" class="edit-mode" name="email" value="<%= user.email %>">
                                </td>
                                <td data-label="Phone" class="hide-mobile">
                                    <span class="view-mode"><%= user.phoneNumber || 'N/A' %></span>
                                    <input type="text" class="edit-mode" name="phoneNumber" value="<%= user.phoneNumber || '' %>">
                                </td>
                                <td data-isAdmin="Is Admin" class="hide-mobile">
                                    <span class="view-mode"><%= user.isAdmin %></span>
                                    <select class="edit-mode" name="isAdmin">
                                        <option value="true" <%= user.isAdmin ? 'selected' : '' %>>true</option>
                                        <option value="false" <%= !user.isAdmin ? 'selected' : '' %>>false</option>
                                    </select>
                                </td>
                                <td data-label="Actions" class="actions-cell">
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-secondary edit-btn" data-action="edit" data-type="user" data-id="<%= user._id %>">
                                            Edit
                                        </button>
                                        <div class="edit-actions edit-mode">
                                            <button class="btn btn-sm btn-success" data-action="save" data-type="user" data-id="<%= user._id %>">
                                                Save
                                            </button>
                                            <button class="btn btn-sm btn-light" data-action="cancel" data-type="user" data-id="<%= user._id %>">
                                                Cancel
                                            </button>
                                            <button class="btn btn-sm btn-danger" data-action="delete" data-type="user" data-id="<%= user._id %>">
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Appointments Tab -->
        <section id="appointments" class="tab-content">
            <div class="section-header">
                <h2>Appointments Management</h2>
                <button class="btn btn-primary" data-action="create" data-type="appointment">
                    <span class="btn-icon">âž•</span>
                    Add Appointment
                </button>
            </div>

            <!-- Filters for Appointments -->
            <div class="filters-container">
                <div class="search-group">
                    <input type="text" id="appointments-search" placeholder="Search appointments..." class="search-input">
                </div>
                <div class="filter-group">
                    <select id="appointments-status-filter" class="filter-select">
                        <option value="">All Statuses</option>
                        <option value="scheduled">Scheduled</option>
                        <option value="completed">Completed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                </div>
                <div class="filter-group">
                    <select id="appointments-customer-filter" class="filter-select">
                        <option value="">All Customers</option>
                        <% users.forEach(user => { %>
                            <option value="<%= user.email.toLowerCase() %>"><%= user.fullName %></option>
                        <% }) %>
                    </select>
                </div>
                <div class="sort-group">
                    <select id="appointments-sort" class="sort-select">
                        <option value="appointmentDate-desc">Date (Newest)</option>
                        <option value="appointmentDate-asc">Date (Oldest)</option>
                        <option value="customer-asc">Customer (A-Z)</option>
                        <option value="customer-desc">Customer (Z-A)</option>
                        <option value="courseName-asc">Course (A-Z)</option>
                        <option value="status-asc">Status (A-Z)</option>
                    </select>
                </div>
                <div class="filter-actions">
                    <button class="btn btn-light btn-sm" id="appointments-clear-filters">Clear Filters</button>
                    <span class="results-count" id="appointments-count"><%= appointments.length %> appointments</span>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Customer</th>
                            <th>Course</th>
                            <th class="hide-mobile">Date</th>
                            <th class="hide-mobile">Time</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% appointments.forEach(appointment => { %>
                            <tr id="appointment-row-<%= appointment._id %>" data-id="<%= appointment._id %>"
                                data-customer="<%= appointment.customer ? appointment.customer.email.toLowerCase() : 'deleted user' %>"
                                data-customer-name="<%= appointment.customer ? appointment.customer.fullName.toLowerCase() : 'deleted user' %>"
                                data-course="<%= appointment.courseName.toLowerCase() %>"
                                data-date="<%= appointment.appointmentDate %>"
                                data-status="<%= appointment.status.toLowerCase() %>"
                                data-created="<%= appointment.createdAt %>">
                                <td data-label="Customer">
                                    <span class="view-mode">
                                        <%= appointment.customer ? appointment.customer.email : 'Deleted User' %>
                                    </span>
                                    <input type="text" class="edit-mode" name="customerEmail" value="<%= appointment.customer ? appointment.customer.email : '' %>">
                                </td>
                                <td data-label="Course">
                                    <span class="view-mode"><%= appointment.courseName %></span>
                                    <input type="text" class="edit-mode" name="courseName" value="<%= appointment.courseName %>">
                                </td>
                                <td data-label="Date" class="hide-mobile">
                                    <span class="view-mode"><%= appointment.appointmentDate %></span>
                                    <input type="date" class="edit-mode" name="appointmentDate" value="<%= appointment.appointmentDate %>">
                                </td>
                                <td data-label="Time" class="hide-mobile">
                                    <span class="view-mode"><%= appointment.appointmentTime %></span>
                                    <input type="text" class="edit-mode" name="appointmentTime" value="<%= appointment.appointmentTime %>">
                                </td>
                                <td data-label="Status">
                                    <span class="view-mode">
                                        <span class="status-badge status-<%= appointment.status.toLowerCase() %>">
                                            <%= appointment.status %>
                                        </span>
                                    </span>
                                    <select class="edit-mode" name="status">
                                        <option value="Scheduled" <%= appointment.status === 'Scheduled' ? 'selected' : '' %>>Scheduled</option>
                                        <option value="Completed" <%= appointment.status === 'Completed' ? 'selected' : '' %>>Completed</option>
                                        <option value="Cancelled" <%= appointment.status === 'Cancelled' ? 'selected' : '' %>>Cancelled</option>
                                    </select>
                                </td>
                                <td data-label="Actions" class="actions-cell">
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-secondary edit-btn" data-action="edit" data-type="appointment" data-id="<%= appointment._id %>">
                                            Edit
                                        </button>
                                        <div class="edit-actions edit-mode">
                                            <button class="btn btn-sm btn-success" data-action="save" data-type="appointment" data-id="<%= appointment._id %>">
                                                Save
                                            </button>
                                            <button class="btn btn-sm btn-light" data-action="cancel" data-type="appointment" data-id="<%= appointment._id %>">
                                                Cancel
                                            </button>
                                            <button class="btn btn-sm btn-danger" data-action="delete" data-type="appointment" data-id="<%= appointment._id %>">
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Invoices Tab -->
        <section id="invoices" class="tab-content">
            <div class="section-header">
                <h2>Invoices Management</h2>
                <button class="btn btn-primary" data-action="create" data-type="invoice">
                    <span class="btn-icon">âž•</span>
                    Add Invoice
                </button>
            </div>

            <!-- Filters for Invoices -->
            <div class="filters-container">
                <div class="search-group">
                    <input type="text" id="invoices-search" placeholder="Search invoices..." class="search-input">
                </div>
                <div class="filter-group">
                    <select id="invoices-status-filter" class="filter-select">
                        <option value="">All Payment Status</option>
                        <option value="paid">Paid</option>
                        <option value="unpaid">Not Paid</option>
                    </select>
                </div>
                <div class="filter-group">
                    <select id="invoices-customer-filter" class="filter-select">
                        <option value="">All Customers</option>
                        <% users.forEach(user => { %>
                            <option value="<%= user.email.toLowerCase() %>"><%= user.fullName %></option>
                        <% }) %>
                    </select>
                </div>
                <div class="sort-group">
                    <select id="invoices-sort" class="sort-select">
                        <option value="dueDate-desc">Due Date (Latest)</option>
                        <option value="dueDate-asc">Due Date (Earliest)</option>
                        <option value="total-desc">Total (High to Low)</option>
                        <option value="total-asc">Total (Low to High)</option>
                        <option value="customer-asc">Customer (A-Z)</option>
                        <option value="invoiceNumber-asc">Invoice # (A-Z)</option>
                        <option value="isPaid-asc">Payment Status</option>
                    </select>
                </div>
                <div class="filter-actions">
                    <button class="btn btn-light btn-sm" id="invoices-clear-filters">Clear Filters</button>
                    <span class="results-count" id="invoices-count"><%= invoices.length %> invoices</span>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Invoice #</th>
                            <th>Customer</th>
                            <th class="hide-mobile">Session Date</th>
                            <th class="hide-mobile">Due Date</th>
                            <th class="hide-mobile">Hours</th>
                            <th class="hide-mobile">Price</th>
                            <th>Total</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% invoices.forEach(invoice => { %>
                            <tr id="invoice-row-<%= invoice._id %>" data-id="<%= invoice._id %>"
                                data-invoice-number="<%= invoice.invoiceNumber.toLowerCase() %>"
                                data-customer="<%= invoice.customer ? invoice.customer.email.toLowerCase() : 'user deleted' %>"
                                data-customer-name="<%= invoice.customer ? invoice.customer.fullName.toLowerCase() : 'user deleted' %>"
                                data-session-date="<%= invoice.sessionDate %>"
                                data-due-date="<%= invoice.dueDate %>"
                                data-total="<%= invoice.total %>"
                                data-paid="<%= invoice.isPaid ? 'paid' : 'unpaid' %>"
                                data-created="<%= invoice.createdAt %>">
                                <td data-label="Invoice #">
                                    <span class="view-mode"><%= invoice.invoiceNumber %></span>
                                    <input type="text" class="edit-mode" name="invoiceNumber" value="<%= invoice.invoiceNumber %>">
                                </td>
                                <td data-label="Customer">
                                    <span class="view-mode">
                                        <%= invoice.customer ? invoice.customer.email : 'User Deleted' %>
                                    </span>
                                    <input type="text" class="edit-mode" name="customerEmail" value="<%= invoice.customer ? invoice.customer.email : '' %>">
                                </td>
                                <td data-label="Session Date" class="hide-mobile">
                                    <span class="view-mode"><%= invoice.sessionDate %></span>
                                    <input type="date" class="edit-mode" name="sessionDate" value="<%= invoice.sessionDate %>">
                                </td>
                                <td data-label="Due Date" class="hide-mobile">
                                    <span class="view-mode"><%= invoice.dueDate %></span>
                                    <input type="date" class="edit-mode" name="dueDate" value="<%= invoice.dueDate %>">
                                </td>
                                <td data-label="Hours" class="hide-mobile">
                                    <span class="view-mode"><%= invoice.hours %></span>
                                    <input type="number" class="edit-mode" name="hours" value="<%= invoice.hours %>">
                                </td>
                                <td data-label="Price" class="hide-mobile">
                                    <span class="view-mode">$<%= invoice.price %></span>
                                    <input type="number" class="edit-mode" name="price" value="<%= invoice.price %>" step="0.01">
                                </td>
                                <td data-label="Total">
                                    <span class="view-mode total-amount">$<%= invoice.total %></span>
                                </td>
                                <td data-label="Status">
                                    <span class="view-mode">
                                        <span class="status-badge <%= invoice.isPaid ? 'status-paid' : 'status-unpaid' %>">
                                            <%= invoice.isPaid ? 'Paid' : 'Not Paid' %>
                                        </span>
                                    </span>
                                    <select class="edit-mode" name="isPaid">
                                        <option value="true" <%= invoice.isPaid ? 'selected' : '' %>>Paid</option>
                                        <option value="false" <%= !invoice.isPaid ? 'selected' : '' %>>Not Paid</option>
                                    </select>
                                </td>
                                <td data-label="Actions" class="actions-cell">
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-secondary edit-btn" data-action="edit" data-type="invoice" data-id="<%= invoice._id %>">
                                            Edit
                                        </button>
                                        <div class="edit-actions edit-mode">
                                            <button class="btn btn-sm btn-success" data-action="save" data-type="invoice" data-id="<%= invoice._id %>">
                                                Save
                                            </button>
                                            <button class="btn btn-sm btn-light" data-action="cancel" data-type="invoice" data-id="<%= invoice._id %>">
                                                Cancel
                                            </button>
                                            <button class="btn btn-sm btn-danger" data-action="delete" data-type="invoice" data-id="<%= invoice._id %>">
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>
        </section>
    </div>

    <!-- Modal overlay -->
    <div class="modal-overlay" id="modal-overlay"></div>

    <!-- Create forms will be dynamically inserted here -->
    <div id="modal-container"></div>

    <script src="/js/dashboard.js"></script>
</body>
</html>